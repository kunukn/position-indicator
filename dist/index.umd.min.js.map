{"version":3,"file":"index.umd.min.js","sources":["../src/index.ts"],"sourcesContent":["export type updateType = 'init' | 'scroll' | 'resize' | 'heightChange'\n\nexport interface UpdateParams {\n  position: number\n  updateType: updateType\n  hasScroll: boolean\n  lastUpdated: number\n}\n\nexport interface Options {\n  onInit: (data: UpdateParams) => {} | void\n  onUpdate: (data: UpdateParams) => {} | void\n}\n\ninterface Events {\n  onScroll?: () => void\n  onResize?: () => void\n  onHeightChange?: () => void\n  resizeObserver?: ResizeObserver\n}\n\nlet _getFullDocumentHeight = () =>\n  Math.max(document.body.scrollHeight, document.documentElement.scrollHeight)\n\nlet _getViewPortHeight = () => window.innerHeight\n\nlet _getScrollYPosition = () => window.pageYOffset\n\nlet _hasScroll = () => _getFullDocumentHeight() > _getViewPortHeight()\n\nlet _clamp = (value: number, min: number, max: number) =>\n  Math.min(Math.max(value, min), max)\n\nlet _onUpdate = (updateType: updateType): UpdateParams => {\n  let fullDocumentHeight = _getFullDocumentHeight()\n  let viewPortHeight = _getViewPortHeight()\n  let scrollYPosition = _getScrollYPosition()\n\n  let relative = fullDocumentHeight - viewPortHeight\n  let position = _clamp(scrollYPosition / (relative || 1), 0, 1)\n  return {\n    position,\n    updateType,\n    hasScroll: _hasScroll(),\n    lastUpdated: Date.now(),\n  }\n}\n\nlet _init = (\n  { onInit: initCallback, onUpdate: updateCallback }: Options,\n  events: Events\n) => {\n  events.onScroll = () => {\n    if (updateCallback) {\n      updateCallback(_onUpdate('scroll'))\n    }\n  }\n  events.onResize = () => {\n    if (updateCallback) {\n      updateCallback(_onUpdate('resize'))\n    }\n  }\n  events.onHeightChange = () => {\n    if (updateCallback) {\n      updateCallback(_onUpdate('heightChange'))\n    }\n  }\n\n  /**\n   * Throttling for event is not used.\n   * Because it has the same effect same as rAF.\n   * https://stackoverflow.com/a/44779316/815507\n   */\n  window.addEventListener('scroll', events.onScroll)\n  window.addEventListener('resize', events.onResize)\n\n  if (typeof ResizeObserver !== 'undefined') {\n    events.resizeObserver = new ResizeObserver(events.onHeightChange)\n    events.resizeObserver.observe(document.body)\n  }\n\n  initCallback && initCallback(_onUpdate('init'))\n}\n\nlet _destroy = (events: Events) => {\n  events.onScroll && window.removeEventListener('scroll', events.onScroll)\n  events.onResize && window.removeEventListener('resize', events.onResize)\n  events.resizeObserver && events.resizeObserver.unobserve(document.body)\n}\n\nexport const createPositionIndicator = (options: Options) => {\n  let events: Events = {\n    onScroll: null,\n    onResize: null,\n    onHeightChange: null,\n    resizeObserver: null,\n  }\n\n  return {\n    hasScroll: () => _hasScroll(),\n    getFullDocumentHeight: () => _getFullDocumentHeight(),\n    getViewPortHeight: () => _getViewPortHeight(),\n    getScrollYPosition: () => _getScrollYPosition(),\n    init: () => _init(options, events),\n    destroy: () => {\n      _destroy(events)\n      events = {}\n    },\n  }\n}\n"],"names":["_getFullDocumentHeight","Math","max","document","body","scrollHeight","documentElement","_getViewPortHeight","window","innerHeight","_getScrollYPosition","pageYOffset","_hasScroll","_onUpdate","updateType","value","min","fullDocumentHeight","viewPortHeight","scrollYPosition","position","hasScroll","lastUpdated","Date","now","options","events","onScroll","onResize","onHeightChange","resizeObserver","getFullDocumentHeight","getViewPortHeight","getScrollYPosition","init","_a","initCallback","updateCallback","addEventListener","ResizeObserver","observe","_init","destroy","removeEventListener","unobserve","_destroy"],"mappings":";;;;;yPAqBA,IAAIA,EAAyB,WAC3B,OAAAC,KAAKC,IAAIC,SAASC,KAAKC,aAAcF,SAASG,gBAAgBD,eAE5DE,EAAqB,WAAM,OAAAC,OAAOC,aAElCC,EAAsB,WAAM,OAAAF,OAAOG,aAEnCC,EAAa,WAAM,OAAAZ,IAA2BO,KAK9CM,EAAY,SAACC,GACf,IAJYC,EAAeC,EAAad,EAIpCe,EAAqBjB,IACrBkB,EAAiBX,IACjBY,EAAkBT,IAItB,MAAO,CACLU,UAXUL,EASUI,GADPF,EAAqBC,GACiB,GAT1BF,EAS8B,EATjBd,EASoB,EAR5DD,KAAKe,IAAIf,KAAKC,IAAIa,EAAOC,GAAMd,IAW7BY,aACAO,UAAWT,IACXU,YAAaC,KAAKC,kCA8CiB,SAACC,GACtC,IAAIC,EAAiB,CACnBC,SAAU,KACVC,SAAU,KACVC,eAAgB,KAChBC,eAAgB,MAGlB,MAAO,CACLT,UAAW,WAAM,OAAAT,KACjBmB,sBAAuB,WAAM,OAAA/B,KAC7BgC,kBAAmB,WAAM,OAAAzB,KACzB0B,mBAAoB,WAAM,OAAAvB,KAC1BwB,KAAM,WAAM,OAvDJ,SACVC,EACAT,OADUU,WAAwBC,aAGlCX,EAAOC,SAAW,WACZU,GACFA,EAAexB,EAAU,YAG7Ba,EAAOE,SAAW,WACZS,GACFA,EAAexB,EAAU,YAG7Ba,EAAOG,eAAiB,WAClBQ,GACFA,EAAexB,EAAU,kBAS7BL,OAAO8B,iBAAiB,SAAUZ,EAAOC,UACzCnB,OAAO8B,iBAAiB,SAAUZ,EAAOE,UAEX,oBAAnBW,iBACTb,EAAOI,eAAiB,IAAIS,eAAeb,EAAOG,gBAClDH,EAAOI,eAAeU,QAAQrC,SAASC,OAGzCgC,GAAgBA,EAAavB,EAAU,SAsBzB4B,CAAMhB,EAASC,IAC3BgB,QAAS,YApBE,SAAChB,GACdA,EAAOC,UAAYnB,OAAOmC,oBAAoB,SAAUjB,EAAOC,UAC/DD,EAAOE,UAAYpB,OAAOmC,oBAAoB,SAAUjB,EAAOE,UAC/DF,EAAOI,gBAAkBJ,EAAOI,eAAec,UAAUzC,SAASC,MAkB9DyC,CAASnB,GACTA,EAAS"}